<!doctype html><html lang=ja><head><meta content=#454351 name=theme-color><meta content="width=device-width,initial-scale=0.1" name=viewport><link href=https://slnq.github.io/style.css rel=stylesheet><meta content=夏 name=description><link href=https://slnq.github.io/f.ico rel=icon><meta charset=utf-8><meta content=夏果 property=og:site_name><meta content=summary name=twitter:card><meta content=https://slnq.github.io/f.ico property=og:image><meta content=@natsuka_sili name=twitter:site><link href=https://slnq.github.io/atom.xml rel=alternate title=RSS type=application/rss+xml><title>夏果</title><body><header><div><span class=about id=hide>とは</span><a href=https://slnq.github.io id=title>夏果</a><a class=about href=https://slnq.github.io/about>とは</a></div><a class=tag href=https://slnq.github.io/tags/browser/><span class=emoji>🔖️</span>browser</a><a class=tag href=https://slnq.github.io/tags/design/><span class=emoji>🔖️</span>design</a><a class=tag href=https://slnq.github.io/tags/event/><span class=emoji>🔖️</span>event</a><a class=tag href=https://slnq.github.io/tags/film/><span class=emoji>🔖️</span>film</a><a class=tag href=https://slnq.github.io/tags/js/><span class=emoji>🔖️</span>JS</a><a class=tag href=https://slnq.github.io/tags/museum/><span class=emoji>🔖️</span>museum</a><a class=tag href=https://slnq.github.io/tags/rust/><span class=emoji>🔖️</span>Rust</a><a class=tag href=https://slnq.github.io/tags/stroll/><span class=emoji>🔖️</span>stroll</a><a class=tag href=https://slnq.github.io/tags/virtual/><span class=emoji>🔖️</span>virtual</a><a class=tag href=https://slnq.github.io/tags/wasm/><span class=emoji>🔖️</span>Wasm</a><a class=tag href=https://slnq.github.io/tags/wired/><span class=emoji>🔖️</span>Wired</a><a class=tag href=https://slnq.github.io/tags/zola/><span class=emoji>🔖️</span>Zola</a></header><meta content=article property=og:type><meta content=Wasmで電場シミュレータを作る property=og:title><meta content="モチベーション卒業研究としてGPU.jsで電場シミュレータを作っている間にWebAssemblyというものを知ってしまい，それ以降はやる気が低下したりしていた．卒研が終わり暇も出来たので，電場シミュレータをWebAssemblyで作り直した．制作物https://slnq.github.io/werve-wasm/機能黒い範囲をクリックすると白いぼやけた円が表示される．これはスライダーによって変化するcharge valueの値に対応した電荷による電場である．このようにして電場を表示するのが主な機能．install:クリックするとchargeに合う値の電荷を置くremove:電荷をクリックすると消すことができるcontrol:電荷をドラッグ・アンド・ドロップで移動させられるfix:電荷をクリックすると固定できるソースコードhttps://github.com/slnq/werve-wasm基本的にsrc内の.jsファイルを読めばシミュレーションについてはわかると思う．処理1つの電荷に対する電界の値を1539×1539で計算しテンプレートに格納する．電荷の位置を元に電界のテンプレートを動かし配列769×769に格納する．電荷の数だけ総和して配列769×769に格納していく．電荷の座標に対応する電界配列の要素を電荷値と乗算してクーロン力を計算する．クーロン力を元に位置と速度と加速度を計算する．表示する．これの2.から6.を繰り返している．配列の大きさの選択理由については記憶が無いが奇数の方が都合が良かったはず．WebAssembly入力と表示以外の全てをRustから変換したWebAssemblyで実行している．これを作った時点ではwgpuというかWebGPUの仕様が変わり続けていたため使っていない．また，表示に適すような配列への変換もこっちで行っている．スマホで触ってみて気がついたが，スワイプだとcontrol(move)が使えないようだ．GPU.jsで作った時は使えているのだから，修正も可能であうと思う．Canvas上述にある，表示に適すような配列をJavaScriptとWebAssemblyの共有メモリーから表示している．GPU.js版にあったベクトル表示ha未だに作っていないため,Canvasは1枚のみでの実装．CSSChatGPTに良い感じのものを作ってもらった．デプロイwebpackを用いてローカルで生成したものをGitHub Pagesで/docs`内をデプロイしている．所感GPU.jsで作った時に比べて情報が多くて楽だった．言語は違うとはいえ一度作った経験があるからというのも大きいだろうが．今後の目標としてはwgpuによる性能向上Canvasを追加してベクトル表示という具合だろうか．" name=description><div class=single><div><div class=headline>Wasmで電場シミュレータを作る <a rel="noopener noreferrer" class=link href=https://slnq.github.io/werve-wasm/ target=_blank>⧉</a></div><span class=page-date>2023.06.29</span><span class=page-tag> <a class=tag href=../../tags/js/><span class=emoji>🔖️</span>JS</a> <a class=tag href=../../tags/rust/><span class=emoji>🔖️</span>Rust</a> <a class=tag href=../../tags/wasm/><span class=emoji>🔖️</span>Wasm</a> </span><div class=page-content><h1 id=motibesiyon>モチベーション</h1><p>卒業研究として<a href=../post/t2-werve-gpujs>GPU.jsで電場シミュレータ</a>を作っている間に<a href=https://webassembly.org>WebAssembly</a>というものを知ってしまい，それ以降はやる気が低下したりしていた．卒研が終わり暇も出来たので，電場シミュレータを<a href=https://webassembly.org>WebAssembly</a>で作り直した．<h1 id=zhi-zuo-wu>制作物</h1><p><a href=https://slnq.github.io/werve-wasm/>https://slnq.github.io/werve-wasm/</a><h2 id=ji-neng>機能</h2><p>黒い範囲をクリックすると白いぼやけた円が表示される．これはスライダーによって変化するcharge valueの値に対応した電荷による電場である．このようにして電場を表示するのが主な機能．<table><thead><tr><th>install<th>:<th>クリックするとchargeに合う値の電荷を置く<tbody><tr><td>remove<td>:<td>電荷をクリックすると消すことができる<tr><td>control<td>:<td>電荷をドラッグ・アンド・ドロップで移動させられる<tr><td>fix<td>:<td>電荷をクリックすると固定できる</table><h2 id=sosukodo>ソースコード</h2><p><a href=https://github.com/slnq/werve-wasm>https://github.com/slnq/werve-wasm</a><p class=br><p>基本的に<code>src</code>内の<code>.js</code>ファイルを読めばシミュレーションについてはわかると思う．<h1 id=chu-li>処理</h1><ol><li>1つの電荷に対する電界の値を1539×1539で計算しテンプレートに格納する．<li>電荷の位置を元に電界のテンプレートを動かし配列769×769に格納する．<li>電荷の数だけ総和して配列769×769に格納していく．<li>電荷の座標に対応する電界配列の要素を電荷値と乗算してクーロン力を計算する．<li>クーロン力を元に位置と速度と加速度を計算する．<li>表示する．</ol><p>これの2.から6.を繰り返している．配列の大きさの選択理由については記憶が無いが奇数の方が都合が良かったはず．<h2 id=webassembly><a href=https://webassembly.org>WebAssembly</a></h2><p>入力と表示以外の全てを<a href=https://www.rust-lang.org/ja>Rust</a>から変換した<a href=https://webassembly.org>WebAssembly</a>で実行している．これを作った時点では<a href=https://wgpu.rs>wgpu</a>というか<a href=https://www.w3.org/TR/webgpu/>WebGPU</a>の仕様が変わり続けていたため使っていない．<br>また，表示に適すような配列への変換もこっちで行っている．<p class=br><p>スマホで触ってみて気がついたが，スワイプだとcontrol(move)が使えないようだ．<a href=../post/t2-werve-gpujs>GPU.jsで作った時</a>は使えているのだから，修正も可能であうと思う．<h2 id=canvas><a href=https://developer.mozilla.org/ja/docs/Web/HTML/Element/canvas>Canvas</a></h2><p>上述にある，表示に適すような配列を<a href=https://developer.mozilla.org/ja/docs/Web/JavaScript>JavaScript</a>と<a href=https://webassembly.org>WebAssembly</a>の共有メモリーから表示している．<br \><a href=https://github.com/slnq/werve-gpujs>GPU.js版</a>にあったベクトル表示ha未だに作っていないため,Canvasは1枚のみでの実装．<h2 id=css><a href=https://developer.mozilla.org/ja/docs/Learn/Getting_started_with_the_web/CSS_basics>CSS</a></h2><p><a href=https://poe.com/s/XGTlkiRiyR4deC8lfmIx>ChatGPTに良い感じのものを作ってもらった．</a><h1 id=depuroi>デプロイ</h1><p><a href=https://webpack.js.org/>webpack</a>を用いてローカルで生成したものを<a href=https://docs.github.com/ja/pages/getting-started-with-github-pages/about-github-pages>GitHub Pages</a>で/docs`内をデプロイしている．<h1 id=suo-gan>所感</h1><p><a href=../post/t2-werve-gpujs>GPU.jsで作った時</a>に比べて情報が多くて楽だった．言語は違うとはいえ一度作った経験があるからというのも大きいだろうが．<br>今後の目標としては<ul><li><a href=https://wgpu.rs>wgpu</a>による性能向上<li><a href=https://developer.mozilla.org/ja/docs/Web/HTML/Element/canvas>Canvas</a>を追加してベクトル表示</ul><p>という具合だろうか．</p><br></div></div></div><footer><a href=https://slnq.github.io>表紙</a><a href=https://slnq.github.io/about/>紹介</a><a href=https://slnq.github.io/atom.xml>購読</a><a href=https://slnq.github.io/search/>全文</a><a href=https://slnq.github.io/links/>関連</a><a href=https://slnq.github.io/photos/>写真</a><a href=https://slnq.github.io/photols/>風景</a><a href=https://slnq.github.io/animation/>映像</a><a href=https://slnq.github.io/page/>短文</a></footer>